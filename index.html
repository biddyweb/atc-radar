<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <link href="/css/site.css" rel="stylesheet" type="text/css">
  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
  <title>Open Air Data : ATC Radar Sites</title>
  <script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
  <script src="geojson.js" type="text/javascript"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
</head>
<body>
  <div id="header">
    About
  </div>
  <div id="map">
  </div>
</body>
<script type="text/javascript">

$(function() {
  var map = new google.maps.Map(document.getElementById('map'),{
    zoom: 17,
    center: new google.maps.LatLng(35.042248, -80.662319),
    mapTypeId: google.maps.MapTypeId.HYBRID
  });

  var infoWindow = new google.maps.InfoWindow();

  function setInfoWindow(feature) {
    google.maps.event.addListener(feature, "click", function(event) {
      var content = "<div id='infoBox'><strong>Radar site info</strong>";
      content += "<table>";
      for (var j in this.geojsonProperties) {
        content += "<tr><td>" + j + "</td><td>" + this.geojsonProperties[j] + "</td></tr>";
      }
      content += "</table></div>";
      infoWindow.setContent(content);
      //infoWindow.position = event.latLng;
      infoWindow.open(map, feature);
    });
  }

  function showRadarSites(geoJson) {
    var googleOptions = {
      strokeColor: '#CCC',
      strokeWeight: 1
    };
    var features = new GeoJSON(geoJson, googleOptions);
    if (features.error) {
      alert(features.message);
    } else {
      var bounds = new google.maps.LatLngBounds();
      for (var i = 0; i < features.length; i++) {
        bounds.extend(features[i].getPosition());
        features[i].setMap(map);
        setInfoWindow(features[i]);
      }
      map.fitBounds(bounds);
      map.setCenter(bounds.getCenter());
    }
  }

  $.getJSON(
    'https://raw.github.com/open-air-data/atc-radar/master/data/radars.geojson',
    function(data) {
      showRadarSites(data);
    });
});

</script>
</html>
