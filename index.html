<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link href="css/site.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
    <title>Open Air Data : ATC Radar Sites</title>
    <script src="//maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
    <script src="geojson.js" type="text/javascript"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
  </head>
  <body>
    <div id="header">
      <span id="title"><a href="about.html">OPEN AIR DATA - ATC Radar Sites</a></span>
    </div>
    <div id="map">
    </div>
  </body>
  <script type="text/javascript">

$(function() {

  var __slice = [].slice;

  function htmlEncode(str) {
    return String(str)
      .replace(/&/g, '&amp;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;');
  }

  function startsWith(str, prefix) {
    return str.lastIndexOf(prefix, 0) == 0;
  }


  var map = new google.maps.Map(document.getElementById('map'),{
    zoom: 17,
    center: new google.maps.LatLng(0, 0),
    mapTypeId: google.maps.MapTypeId.HYBRID
  });

  var infoWindow = new google.maps.InfoWindow();

  function setInfoWindow(feature) {
    google.maps.event.addListener(feature, "click", function(event) {
      var content = "<div id='infobox'><div class='infobox-header'>SITE INFO</div>";
      content += "<table>";
      for (var j in this.geojsonProperties) {
        var value = this.geojsonProperties[j];
        if (typeof value == 'string' &&
            (startsWith(value, 'http://') ||
             startsWith(value, 'https://') ||
             startsWith(value, 'ftp://'))) {
          value = ('<a target="_blank" href="' + htmlEncode(value) + '">' + htmlEncode(value) +
                   '</a>');
        }
        content += "<tr><td>" + j + "</td><td>" + value + "</td></tr>";
      }
      content += "</table></div>";
      infoWindow.setContent(content);
      //infoWindow.position = event.latLng;
      infoWindow.open(map, feature);
    });
  }

  function showRadarSites(geoJson) {
    var googleOptions = {
      strokeColor: '#CCC',
      strokeWeight: 1
    };
    var features = new GeoJSON(geoJson, googleOptions);
    if (features.error) {
      alert(features.message);
    } else {
      var bounds = new google.maps.LatLngBounds();
      for (var i = 0; i < features.length; i++) {
        bounds.extend(features[i].getPosition());
        features[i].setMap(map);
        setInfoWindow(features[i]);
      }
      map.fitBounds(bounds);
      map.setCenter(bounds.getCenter());
    }
  }

  $.getJSON(
    'data/radars.geojson',
    function(data) {
      showRadarSites(data);
    });
});

  </script>
</html>
